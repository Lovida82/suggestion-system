# 제안제도 시스템 - 결재 흐름 설계 문서

**작성일:** 2026-02-02
**시스템:** 아주약품 제안제도 시스템 v3.2.0

---

## 1. 핵심: 60점 분기 시스템

```
┌─────────────────────────────────────────────────────────────────┐
│                        제안서 제출                               │
│         currentApproverId = 1차 평가자, stage = 1               │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                    1차 평가 (소위원회)                           │
│     점수 = 노력도(15) + 창의성(15) + max(품질,안전)(10)          │
│                      + 유형효과(0~60)                           │
└─────────────────────────────────────────────────────────────────┘
                              ↓
              ┌───────────────┴───────────────┐
              ↓                               ↓
     ┌────────────────┐              ┌────────────────┐
     │  60점 이하     │              │  60점 초과     │
     │                │              │                │
     │ → 평가 종료    │              │ → 2차로 이관   │
     │ status=approved│              │ stage=2        │
     │ currentApprover│              │ currentApprover│
     │   = null       │              │   = 2차 평가자 │
     └────────────────┘              └────────────────┘
                                              ↓
                                 ┌─────────────────────┐
                                 │  2차 평가 (제안위원회)│
                                 └─────────────────────┘
                                              ↓
                              ┌───────────────┴───────────────┐
                              ↓                               ↓
                     ┌────────────────┐              ┌────────────────┐
                     │ 3차 평가자 있음 │              │ 3차 평가자 없음 │
                     │ → 3차로 이관   │              │ → 최종 승인    │
                     └────────────────┘              └────────────────┘
```

---

## 2. 점수 체계

| 항목 | 점수 범위 | 비고 |
|------|----------|------|
| 노력도 | 0~15점 | 필수 |
| 창의성 | 0~15점 | 필수 |
| 품질효과 | 0~10점 | 품질/안전 중 높은 것만 적용 |
| 안전효과 | 0~10점 | (OR 조건) |
| **무형효과 최대** | **40점** | |
| 유형효과 | 15~60점 | 검증 금액 기준 |
| **총점 최대** | **100점** | |

### 2.1 유형효과 점수표

| 검증 금액 (원/년) | 점수 |
|------------------|------|
| 5,000만원 이상 | 60점 |
| 4,000~5,000만원 | 50점 |
| 3,000~4,000만원 | 45점 |
| 2,000~3,000만원 | 40점 |
| 1,000~2,000만원 | 35점 |
| 500~1,000만원 | 30점 |
| 100~500만원 | 25점 |
| 50~100만원 | 20점 |
| 50만원 이하 | 15점 |

### 2.2 등급 기준

| 등급 | 종합점수 | 보상금 |
|------|----------|--------|
| 특급 | 91~100점 | 100만원 |
| 1급 | 81~90점 | 80만원 |
| 2급 | 71~80점 | 60만원 |
| 3급 | 61~70점 | 40만원 |
| 4급 | 56~60점 | 30만원 |
| 5급 | 51~55점 | 20만원 |
| 6급 | 45~50점 | 10만원 |
| 7급 | 41~44점 | 7만원 |
| 8급 | 31~40점 | 5만원 |
| 9급 | 21~30점 | 3만원 |
| 10급 | 0~20점 | 2만원 |

---

## 3. 60점 분기의 의미

- **무형효과만 있는 경우**: 최대 40점 → **항상 1차에서 종료**
- **유형효과가 있는 경우**: 검증 금액에 따라 60점 초과 가능 → **2차 평가 진행**

즉, **고가치 제안(금액 절감이 큰 제안)만 2차 평가로 자동 선별**되는 구조입니다.

---

## 4. 결재 단계 구조

| 단계 | 명칭 | 역할 | 점수 역할 |
|------|------|------|----------|
| **stage 1** | 소위원회(1차) | 초기 평가 | 60점 분기점 결정 |
| **stage 2** | 제안위원회(2차) | 고득점 검토 | 최종 승인 |
| **stage 3+** | 3차 이상 (선택) | 추가 검토 | 필요시 추가 |

---

## 5. 주요 데이터 구조

### 5.1 approvalLines 컬렉션

```javascript
{
  department: "영업팀",
  active: true,
  approvers: [
    { level: 1, id: "A197001", name: "김팀장", jobTitle: "팀장" },  // 소위원회
    { level: 2, id: "A197002", name: "박부장", jobTitle: "부장" },  // 제안위원회
    { level: 3, id: "A197003", name: "이감사", jobTitle: "감사" }   // (선택)
  ]
}
```

### 5.2 suggestions 문서

```javascript
{
  stage: 1,                     // 현재 평가 단계
  status: 'pending',            // pending/approved/rejected/revision_requested
  currentApproverId: "A197001", // 현재 결재 담당자
  approvalLineId: "xxx",        // 결재선 참조
  approvalHistory: [            // 결재 이력
    {
      approverId: "A197001",
      approverName: "김팀장",
      status: "approved",
      level: 1,
      approvedAt: Date,
      scores: { effort, creativity, quality, safety, total, grade },
      comment: "..."
    }
  ],
  scores: {
    self: { effort, creativity, quality, safety, total, grade },
    stage1: { ... },  // 1차 평가 결과
    stage2: { ... }   // 2차 평가 결과
  }
}
```

---

## 6. 시나리오별 처리 흐름

### 시나리오 1: 무형효과만 있는 경우 (최대 40점)

```
제안 제출
  ↓
1차 평가: effort(15) + creativity(15) + max(quality,safety)(10) = 40점
  ↓
40점 <= 60 → 평가 종료
  └─ currentApproverId = null
  └─ status = 'approved'
```

### 시나리오 2: 유형효과 있고 60점 이하

```
제안 제출 (유형효과 있음)
  ↓
유형효과 검증 (예: 금액 50만원 = 20점)
  ↓
1차 평가: effort(15) + creativity(15) + 유형효과(20) = 50점
  ↓
50점 <= 60 → 평가 종료
```

### 시나리오 3: 유형효과 있고 60점 초과

```
제안 제출 (유형효과 있음)
  ↓
유형효과 검증 (예: 금액 5000만원 = 60점)
  ↓
1차 평가: effort(10) + creativity(10) + 유형효과(60) = 80점
  ↓
80점 > 60 → 2차 평가자에게 이관
  └─ currentApproverId = 2차 평가자 ID
  └─ stage = 2
  ↓
2차 평가 완료
  └─ 최종 승인 또는 3차로 이관
```

---

## 7. 핵심 코드 위치

| 기능 | 파일 | 라인 |
|------|------|------|
| 60점 분기 로직 | leader.html | 1886-1913 |
| 점수 계산 | leader.html | 1759-1775 |
| 등급 계산 | leader.html | 1778-1799 |
| 승인 처리 (dashboard) | dashboard.html | 4010-4090 |
| 제안 제출 | dashboard.html | 2250-2430 |
| 결재 라인 설정 | admin.html | 3019-3036 |

---

## 8. 핵심 분기 코드

```javascript
// leader.html, dashboard.html의 approveSuggestion 함수
if (currentStage === 1) {
    if (totalScore <= 60) {
        // 60점 이하: 평가 종료
        updateData.currentApproverId = null;
        updateData.status = 'approved';
    } else if (nextApprover && nextApprover.id) {
        // 60점 초과: 2차 평가자에게 이관
        updateData.currentApproverId = nextApprover.id;
        updateData.stage = currentStage + 1;
    }
} else if (nextApprover && nextApprover.id) {
    // 2차 이상: 다음 단계로 이동
    updateData.currentApproverId = nextApprover.id;
    updateData.stage = currentStage + 1;
} else {
    // 최종 승인
    updateData.currentApproverId = null;
    updateData.status = 'approved';
}
```

---

**이 문서는 시스템 설계 참고용으로 작성되었습니다.**
